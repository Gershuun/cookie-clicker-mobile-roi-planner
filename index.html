<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cookie Clicker Mobile ROI Planner (Full Buildings · Editable Fix)</title>
<style>
  :root { color-scheme: light; --bg:#f8fafc; --card:#fff; --fg:#0f172a; --muted:#64748b; --br:#e2e8f0; --pri:#0369a1; --ok:#059669; }
  *{box-sizing:border-box} body{margin:0;font:16px system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--fg);background:var(--bg)}
  .wrap{max-width:980px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:16px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .card{background:var(--card);border:1px solid var(--br);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  h1{font-size:22px;margin:0 0 8px}
  h2{font-size:18px;margin:0 0 10px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  input,select{height:40px;border:1px solid var(--br);border-radius:10px;padding:0 10px;width:100%}
  input[type="number"]{appearance:textfield;-moz-appearance:textfield}
  input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{appearance:none;margin:0}
  .grid{display:grid;gap:8px}
  .btn{height:36px;padding:0 12px;border-radius:10px;border:1px solid var(--br);background:#fff}
  .btn.pri{background:var(--pri);color:#fff;border-color:var(--pri)}
  .muted{color:var(--muted)} .small{font-size:12px}
  .pill{padding:2px 8px;border:1px solid var(--br);border-radius:999px;font-size:12px}
  .note{background:#ecfeff;border:1px dashed #bae6fd;padding:8px;border-radius:10px}
</style>
</head>
<body>
<div class="wrap">
  <div class="row" style="justify-content:space-between">
    <h1>Cookie Clicker Mobile ROI Planner <span class="small muted">(Full Buildings · Editable Fix)</span></h1>
    <div class="row">
      <button class="btn" id="btnExport">Export JSON</button>
      <button class="btn" id="btnReset">Reset</button>
    </div>
  </div>

  <div class="card">
    <h2>Overview</h2>
    <div class="grid" style="grid-template-columns:repeat(5,minmax(0,1fr))">
      <div><label>Bank (cookies)</label><input id="bank" type="number" inputmode="numeric" step="1" min="0"></div>
      <div><label>Total CPS (computed)</label><div id="totalCps" class="pill">0 /s</div></div>
      <div><label>Milk % (0–100)</label><input id="milk" type="number" inputmode="decimal" step="0.1" min="0"></div>
      <div><label>Extra Global Multiplier</label><input id="extra" type="number" inputmode="decimal" step="0.01" min="0"></div>
      <div class="small muted" style="display:flex;align-items:end">Kittens scale with Milk. Use Extra Global for buffs.</div>
    </div>
  </div>

  <div class="card">
    <h2>Next Best Buys (by payback hours)</h2>
    <div id="top3" class="grid"></div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h2>Buildings</h2>
      <div class="note small">Tip: Tap the <b>Owned</b> number and type. It updates instantly.</div>
    </div>
    <div class="small muted row" style="gap:16px">
      <div style="flex:1.2">Name</div><div style="flex:.8">Owned</div><div style="flex:.8">Base Cost</div><div style="flex:.8">Base CPS</div><div style="flex:.8">Growth</div><div>—</div>
    </div>
    <div id="buildings" class="grid"></div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h2>Upgrades</h2>
      <button class="btn" id="addU">Add upgrade</button>
    </div>
    <div class="small muted row" style="gap:16px">
      <div style="flex:1.2">Name</div><div style="flex:.9">Kind</div><div style="flex:.7">Value</div><div style="flex:.9">Affects</div><div style="flex:.8">Purchased</div><div style="flex:.9">Cost</div><div>—</div>
    </div>
    <div id="upgrades" class="grid"></div>
  </div>

  <div class="small muted" style="text-align:center;padding:8px 0">All data saved locally · Works offline</div>
</div>

<script>
// Full buildings list (19)
const DEFAULT_BUILDINGS = [
  { id: "cursor", name: "Cursor", baseCost: 15, baseCps: 0.1, growth: 1.15, owned: 0, enabled: true },
  { id: "grandma", name: "Grandma", baseCost: 100, baseCps: 1, growth: 1.15, owned: 0, enabled: true },
  { id: "farm", name: "Farm", baseCost: 1100, baseCps: 8, growth: 1.15, owned: 0, enabled: true },
  { id: "mine", name: "Mine", baseCost: 12000, baseCps: 47, growth: 1.15, owned: 0, enabled: true },
  { id: "factory", name: "Factory", baseCost: 130000, baseCps: 260, growth: 1.15, owned: 0, enabled: true },
  { id: "bank", name: "Bank", baseCost: 1400000, baseCps: 1400, growth: 1.15, owned: 0, enabled: true },
  { id: "temple", name: "Temple", baseCost: 20000000, baseCps: 7800, growth: 1.15, owned: 0, enabled: true },
  { id: "wizard", name: "Wizard Tower", baseCost: 330000000, baseCps: 44000, growth: 1.15, owned: 0, enabled: true },
  { id: "shipment", name: "Shipment", baseCost: 5100000000, baseCps: 260000, growth: 1.15, owned: 0, enabled: true },
  { id: "alchemy", name: "Alchemy Lab", baseCost: 75000000000, baseCps: 1600000, growth: 1.15, owned: 0, enabled: true },
  { id: "portal", name: "Portal", baseCost: 1000000000000, baseCps: 10000000, growth: 1.15, owned: 0, enabled: true },
  { id: "time", name: "Time Machine", baseCost: 14000000000000, baseCps: 65000000, growth: 1.15, owned: 0, enabled: true },
  { id: "condenser", name: "Antimatter Condenser", baseCost: 170000000000000, baseCps: 430000000, growth: 1.15, owned: 0, enabled: true },
  { id: "prism", name: "Prism", baseCost: 2100000000000000, baseCps: 2900000000, growth: 1.15, owned: 0, enabled: true },
  { id: "chancemaker", name: "Chancemaker", baseCost: 26000000000000000, baseCps: 21000000000, growth: 1.15, owned: 0, enabled: true },
  { id: "fractal", name: "Fractal Engine", baseCost: 310000000000000000, baseCps: 150000000000, growth: 1.15, owned: 0, enabled: true },
  { id: "javascript", name: "Javascript Console", baseCost: 7100000000000000000, baseCps: 1000000000000, growth: 1.15, owned: 0, enabled: true },
  { id: "idleverse", name: "Idleverse", baseCost: 120000000000000000000, baseCps: 6500000000000, growth: 1.15, owned: 0, enabled: true },
  { id: "cortex", name: "Cortex Baker", baseCost: 1900000000000000000000, baseCps: 43000000000000, growth: 1.15, owned: 0, enabled: true }
];

const STARTER_UPGRADES = [
  { id:"reinforced-finger", name:"Reinforced index finger", kind:"buildingMultiplier", value:2, affects:"cursor", purchased:false },
  { id:"carpal-cream", name:"Carpal tunnel prevention cream", kind:"buildingMultiplier", value:2, affects:"cursor", purchased:false },
  { id:"ambidextrous", name:"Ambidextrous", kind:"buildingMultiplier", value:2, affects:"cursor", purchased:false },
  { id:"thousand-fingers", name:"Thousand fingers", kind:"cursorFingers", value:0.1, mult:1, purchased:false },
  { id:"kitten-helpers", name:"Kitten helpers", kind:"kitten", value:0.1, purchased:false },
];

const LS_KEY = "cc-mobile-roi-standalone-full-fix";
const COSTS_KEY = LS_KEY + "-costs";

const S0 = JSON.parse(localStorage.getItem(LS_KEY) || "null") || {
  bank: 0, extraGlobalMultiplier: 1, milkPercent: 0, buildings: DEFAULT_BUILDINGS, upgrades: STARTER_UPGRADES
};
let state = S0;
let upgradeCosts = JSON.parse(localStorage.getItem(COSTS_KEY) || "{}");

function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); localStorage.setItem(COSTS_KEY, JSON.stringify(upgradeCosts)); }
function parseNum(v, fallback=0){ const n = Number(v); return Number.isFinite(n) ? n : fallback; }

function fmt(n){
  if(!isFinite(n)) return "—";
  const a=Math.abs(n); if(a<1e4) return n.toLocaleString();
  const u=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"]; let i=0, x=n;
  while(Math.abs(x)>=1000 && i<u.length-1){ x/=1000; i++; }
  return x.toFixed(3)+u[i];
}
function nextCost(b){ return b.baseCost * Math.pow(b.growth||1.15, b.owned); }
function totalFlatCps(){ return state.upgrades.filter(u=>u.purchased && u.kind==="flatCps").reduce((s,u)=>s+u.value,0); }
function buildingCps(b){
  const perMult = state.upgrades.filter(u=>u.purchased && u.kind==="buildingMultiplier" && u.affects===b.id).reduce((m,u)=>m*u.value,1);
  const kittenMult = state.upgrades.filter(u=>u.purchased && u.kind==="kitten").reduce((m,u)=>m*(1 + (state.milkPercent * (u.value||0))),1);
  const globalMult = state.upgrades.filter(u=>u.purchased && u.kind==="globalMultiplier").reduce((m,u)=>m*u.value,1) * (state.extraGlobalMultiplier||1) * kittenMult;
  let cps = b.owned * b.baseCps * perMult * globalMult;
  if(b.id==="cursor"){
    const nonCursor = state.buildings.filter(x=>x.id!=="cursor").reduce((s,x)=>s+x.owned,0);
    const fingers = state.upgrades.filter(u=>u.purchased && u.kind==="cursorFingers");
    if(fingers.length){
      const base = fingers.reduce((s,u)=>s+(u.value||0),0);
      const mult = fingers.reduce((m,u)=>m*(u.mult||1),1);
      const perCursorBonus = nonCursor * base * mult;
      cps += b.owned * perCursorBonus * globalMult;
    }
  }
  return cps;
}
function totalCps(){
  const flat = totalFlatCps();
  const sum = state.buildings.filter(b=>b.enabled).reduce((s,b)=>s+buildingCps(b),0);
  return sum + flat;
}
function candidates(){
  const out=[]; const base=totalCps();
  for(const b of state.buildings.filter(x=>x.enabled)){
    const cost=nextCost(b);
    const draft=JSON.parse(JSON.stringify(state));
    const i=draft.buildings.findIndex(x=>x.id===b.id); draft.buildings[i].owned++;
    const delta=Math.max(0, (draft.buildings.filter(x=>x.enabled).reduce((s,x)=>s+buildingCps(x),0)+totalFlatCps()) - base);
    const pay=delta>0? cost/delta/3600 : Infinity;
    out.push({id:"b-"+b.id,label:"Buy 1 "+b.name,type:"building",cost,deltaCps:delta,paybackHours:pay,apply:(d)=>{const nd=JSON.parse(JSON.stringify(d)); nd.buildings[i].owned++; return nd;}});
  }
  for(const u of state.upgrades.filter(u=>!u.purchased)){
    const cost=upgradeCosts[u.id]; if(!cost||cost<=0) continue;
    const draft=JSON.parse(JSON.stringify(state));
    const i=draft.upgrades.findIndex(x=>x.id===u.id); draft.upgrades[i].purchased=true;
    const delta=Math.max(0, (draft.buildings.filter(x=>x.enabled).reduce((s,x)=>s+buildingCps(x),0)+totalFlatCps()) - base);
    const pay=delta>0? cost/delta/3600 : Infinity;
    out.push({id:"u-"+u.id,label:"Buy upgrade: "+u.name,type:"upgrade",cost,deltaCps:delta,paybackHours:pay,apply:(d)=>{const nd=JSON.parse(JSON.stringify(d)); nd.upgrades[i].purchased=true; return nd;}});
  }
  return out.sort((a,b)=>a.paybackHours-b.paybackHours);
}

function renderTop3(){
  const el=document.getElementById("top3"); el.innerHTML="";
  const list=candidates().slice(0,3);
  if(!list.length){ el.innerHTML='<div class="small muted">No candidates yet — add buildings or upgrades below.</div>'; return; }
  for(const c of list){
    const row=document.createElement("div");
    row.className="row"; row.style.cssText="justify-content:space-between;border:1px solid var(--br);border-radius:12px;padding:10px;";
    row.innerHTML=`<div><div><b>${c.label}</b></div><div class="small muted">ΔCPS ${fmt(c.deltaCps)} — Cost ${fmt(c.cost)} — Payback ${c.paybackHours===Infinity?"—":c.paybackHours.toFixed(3)+" h"}</div></div>
                   <button class="btn pri">Mark purchased</button>`;
    row.querySelector("button").onclick=()=>{ state=c.apply(state); save(); update(); };
    el.appendChild(row);
  }
}
function renderBuildings(){
  const el=document.getElementById("buildings"); el.innerHTML="";
  for(const b of state.buildings){
    const row=document.createElement("div");
    row.className="row"; row.style.cssText="border:1px solid var(--br);border-radius:12px;padding:8px;gap:8px";
    row.innerHTML=`
      <input value="${b.name}" aria-label="Building name">
      <input type="number" inputmode="numeric" min="0" step="1" value="${b.owned}" aria-label="Owned">
      <input type="number" inputmode="decimal" min="0" step="1" value="${b.baseCost}" aria-label="Base cost">
      <input type="number" inputmode="decimal" min="0" step="0.001" value="${b.baseCps}" aria-label="Base CPS">
      <input type="number" inputmode="decimal" min="1" step="0.01" value="${b.growth}" aria-label="Growth">
      <div class="row"><span class="small muted">Next: ${fmt(nextCost(b))}</span>
        <label class="small muted"><input type="checkbox" ${b.enabled?"checked":""}> enabled</label>
        <button class="btn">✕</button>
      </div>`;
    const [nameEl,ownEl,costEl,cpsEl,growEl]=row.querySelectorAll("input");
    nameEl.oninput=e=>{ b.name=e.target.value; save(); update(); };
    ownEl.oninput=e=>{ b.owned=parseNum(e.target.value,0); if(b.owned<0)b.owned=0; save(); update(); };
    ownEl.onchange=e=>{ if(e.target.value==="") { b.owned=0; ownEl.value=0; save(); update(); } };
    costEl.oninput=e=>{ b.baseCost=parseNum(e.target.value,b.baseCost||0); save(); update(); };
    cpsEl.oninput=e=>{ b.baseCps=parseNum(e.target.value,b.baseCps||0); save(); update(); };
    growEl.oninput=e=>{ b.growth=parseNum(e.target.value,1.15)||1.15; save(); update(); };
    row.querySelector("input[type=checkbox]").onchange=e=>{ b.enabled=e.target.checked; save(); update(); };
    row.querySelector("button.btn").onclick=()=>{ state.buildings=state.buildings.filter(x=>x!==b); save(); update(); };
    el.appendChild(row);
  }
}
function renderUpgrades(){
  const el=document.getElementById("upgrades"); el.innerHTML="";
  for(const u of state.upgrades){
    const row=document.createElement("div");
    row.className="row"; row.style.cssText="border:1px solid var(--br);border-radius:12px;padding:8px;gap:8px";
    row.innerHTML=`
      <input value="${u.name}" aria-label="Upgrade name">
      <select aria-label="Kind">
        <option value="globalMultiplier"${u.kind==="globalMultiplier"?" selected":""}>globalMultiplier</option>
        <option value="buildingMultiplier"${u.kind==="buildingMultiplier"?" selected":""}>buildingMultiplier</option>
        <option value="flatCps"${u.kind==="flatCps"?" selected":""}>flatCps</option>
        <option value="cursorFingers"${u.kind==="cursorFingers"?" selected":""}>cursorFingers</option>
        <option value="kitten"${u.kind==="kitten"?" selected":""}>kitten</option>
        <option value="goldenCookie"${u.kind==="goldenCookie"?" selected":""}>goldenCookie</option>
      </select>
      <input type="number" inputmode="decimal" step="0.01" value="${u.value}" aria-label="Value">
      <select ${u.kind!=="buildingMultiplier"?"disabled":""} aria-label="Affects">
        <option value="">—</option>
        ${state.buildings.map(b=>`<option value="${b.id}" ${u.affects===b.id?"selected":""}>${b.name}</option>`).join("")}
      </select>
      <label class="small muted"><input type="checkbox" ${u.purchased?"checked":""}> purchased</label>
      <input type="number" inputmode="decimal" step="1" value="${upgradeCosts[u.id]||""}" placeholder="cost" aria-label="Cost">
      <div class="row"><button class="btn pri">Mark purchased</button><button class="btn">✕</button></div>
    `;
    const inputs=row.querySelectorAll("input,select");
    inputs[0].oninput=e=>{ u.name=e.target.value; save(); update(); };
    inputs[1].onchange=e=>{ u.kind=e.target.value; save(); update(); };
    inputs[2].oninput=e=>{ u.value=parseNum(e.target.value,u.value||0); save(); update(); };
    inputs[3].onchange=e=>{ u.affects=e.target.value||undefined; save(); update(); };
    inputs[4].onchange=e=>{ u.purchased=e.target.checked; save(); update(); };
    inputs[5].oninput=e=>{ upgradeCosts[u.id]=parseNum(e.target.value,0); save(); update(); };
    row.querySelector("button.pri").onclick=()=>{ u.purchased=true; save(); update(); };
    row.querySelectorAll("button.btn")[1].onclick=()=>{ state.upgrades=state.upgrades.filter(x=>x!==u); save(); update(); };
    el.appendChild(row);
  }
}

function update(){
  document.getElementById("bank").value = state.bank || 0;
  document.getElementById("milk").value = (state.milkPercent||0)*100;
  document.getElementById("extra").value = state.extraGlobalMultiplier || 1;
  document.getElementById("totalCps").textContent = fmt(totalCps()) + " /s";
  renderTop3(); renderBuildings(); renderUpgrades();
}
document.getElementById("bank").oninput=e=>{ state.bank=parseNum(e.target.value,0); save(); update(); };
document.getElementById("milk").oninput=e=>{ state.milkPercent=Math.max(0,parseNum(e.target.value,0))/100; save(); update(); };
document.getElementById("extra").oninput=e=>{ state.extraGlobalMultiplier=parseNum(e.target.value,1); save(); update(); };
document.getElementById("addU").onclick=()=>{ state.upgrades.push({id:crypto.randomUUID(),name:"New Upgrade",kind:"globalMultiplier",value:1.1,purchased:false}); save(); update(); };
document.getElementById("btnExport").onclick=()=>{
  const blob = new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="cc-mobile-roi-planner.json"; a.click(); URL.revokeObjectURL(url);
};
document.getElementById("btnReset").onclick=()=>{
  if(!confirm("Reset all data?")) return;
  localStorage.removeItem(LS_KEY); localStorage.removeItem(COSTS_KEY);
  state={ bank:0, extraGlobalMultiplier:1, milkPercent:0, buildings: DEFAULT_BUILDINGS, upgrades: STARTER_UPGRADES };
  save(); update();
};

update();
</script>
</body>
</html>
